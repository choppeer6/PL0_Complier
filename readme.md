# ğŸ› ï¸ PL/0 ç¼–è¯‘å™¨

è¿™æ˜¯ä¸€ä¸ªåŸºäº **Python** å®ç°çš„å®Œæ•´ **PL/0 ç¼–è¯‘å™¨**ï¼ŒåŒ…å«è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æå’Œä¸­é—´ä»£ç ç”Ÿæˆï¼ˆå››å…ƒå¼ï¼‰ã€‚

## ğŸ“š ç¼–è¯‘åŸç†

### ç¼–è¯‘æµç¨‹

```
æºä»£ç  â†’ è¯æ³•åˆ†æ â†’ Tokenæµ â†’ è¯­æ³•åˆ†æ â†’ è¯­ä¹‰åˆ†æ â†’ å››å…ƒå¼ä¸­é—´ä»£ç 
```

### 1. è¯æ³•åˆ†æ (Lexer)

å°†æºä»£ç åˆ†è§£ä¸º Token æµï¼Œè¯†åˆ«å…³é”®å­—ã€æ ‡è¯†ç¬¦ã€æ•°å­—ã€è¿ç®—ç¬¦ç­‰ã€‚

**ç¤ºä¾‹ï¼š**
```
var x;  â†’  [('VAR', 'var'), ('ID', 'x'), ('SYMBOL', ';')]
```

### 2. è¯­æ³•åˆ†æ (Parser)

ä½¿ç”¨ SLR ç®—æ³•æ£€æŸ¥ Token æµæ˜¯å¦ç¬¦åˆ PL/0 æ–‡æ³•è§„åˆ™ã€‚

### 3. è¯­ä¹‰åˆ†æ (Semantic Analyzer)

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- **ç¬¦å·è¡¨ç®¡ç†**ï¼šè®°å½•å˜é‡ã€å¸¸é‡ã€è¿‡ç¨‹çš„å®šä¹‰å’Œä½œç”¨åŸŸ
- **è¯­ä¹‰æ£€æŸ¥**ï¼šæ£€æŸ¥æ ‡è¯†ç¬¦æ˜¯å¦å£°æ˜ã€ç±»å‹æ˜¯å¦åŒ¹é…ã€ä½œç”¨åŸŸæ˜¯å¦æ­£ç¡®
- **ä¸­é—´ä»£ç ç”Ÿæˆ**ï¼šç”Ÿæˆå››å…ƒå¼ä¸­é—´ä»£ç 

**ç¬¦å·è¡¨ç¤ºä¾‹ï¼š**
```
const max = 100;  â†’  ç¬¦å·è¡¨: {name: 'max', type: å¸¸é‡, value: 100}
var x;            â†’  ç¬¦å·è¡¨: {name: 'x', type: å˜é‡, address: 0}
```

### 4. å››å…ƒå¼ä¸­é—´ä»£ç ç”Ÿæˆ

ç”Ÿæˆå››å…ƒå¼å½¢å¼çš„ä¸­é—´ä»£ç ï¼š**(op, arg1, arg2, result)**

**ç¤ºä¾‹ï¼š**
```
x := a + b;  â†’  0  +    a    b    T0
                1  =    T0   -    x
```

## ğŸ¯ æ”¯æŒçš„è¯­æ³•

- **å¸¸é‡å£°æ˜**: `const a = 10, b = 20;`
- **å˜é‡å£°æ˜**: `var x, y, z;`
- **è¿‡ç¨‹å®šä¹‰**: `procedure name; begin ... end;`
- **èµ‹å€¼è¯­å¥**: `x := 10;`
- **æ¡ä»¶è¯­å¥**: `if x > y then write(x)`
- **å¾ªç¯è¯­å¥**: `while x > 0 do x := x - 1`
- **è¾“å…¥è¾“å‡º**: `read(x);` `write(x);`
- **è¿‡ç¨‹è°ƒç”¨**: `call procedure_name;`
- **è¿ç®—ç¬¦**: `+`, `-`, `*`, `/`, `=`, `#`, `<`, `>`, `<=`, `>=`, `odd`

## ğŸ“‚ é¡¹ç›®ç»“æ„

```text
.
â”œâ”€â”€ app.py              # Streamlit Web ç•Œé¢
â”œâ”€â”€ pl0_lexer.py        # è¯æ³•åˆ†æå™¨
â”œâ”€â”€ pl0_parser.py       # è¯­æ³•åˆ†æå™¨ (SLR)
â”œâ”€â”€ pl0_semantic.py     # è¯­ä¹‰åˆ†æå™¨ + ä»£ç ç”Ÿæˆå™¨
â”œâ”€â”€ pl0_vm.py           # è™šæ‹Ÿæœº
â”œâ”€â”€ pl0_types.py        # ç±»å‹å®šä¹‰
â”œâ”€â”€ test_semantic.py    # æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ examples/           # ç¤ºä¾‹ç¨‹åº (10ä¸ª)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install streamlit
```

### 2. å¯åŠ¨ Web ç•Œé¢

```bash
streamlit run app.py
```

æµè§ˆå™¨è‡ªåŠ¨æ‰“å¼€ `http://localhost:8501`ï¼Œå³å¯ä½¿ç”¨å¯è§†åŒ–ç¼–è¯‘å™¨ã€‚

### 3. å‘½ä»¤è¡Œä½¿ç”¨

```python
from pl0_lexer import Lexer
from pl0_semantic import Parser
from pl0_vm import VM

# PL/0 æºä»£ç 
code = """
var x, y;
begin
    x := 10;
    y := 20;
    write(x + y)
end.
"""

# 1. è¯æ³•åˆ†æ
lexer = Lexer(code)
tokens = lexer.get_tokens()

# 2. è¯­ä¹‰åˆ†æ + ä»£ç ç”Ÿæˆ
parser = Parser(tokens)
p_code = parser.parse()

# 3. è™šæ‹Ÿæœºæ‰§è¡Œ
vm = VM(p_code)
result = vm.run()
print(result)  # è¾“å‡º: 30
```

### 4. è¿è¡Œæµ‹è¯•

```bash
python test_semantic.py
```

æµ‹è¯•åŒ…å« 12 ä¸ªç”¨ä¾‹ï¼Œæ¶µç›–æ‰€æœ‰è¯­è¨€ç‰¹æ€§ã€‚

## ğŸ“ è¯­æ³•ç¤ºä¾‹

### ç¤ºä¾‹ 1: ç®€å•è®¡ç®—

```pl0
var x, y;
begin
  x := 10;
  y := 20;
    write(x + y)
end.
```

**è¾“å‡º**: `30`

### ç¤ºä¾‹ 2: å¾ªç¯æ±‚å’Œ

```pl0
var n, sum;
begin
    n := 5;
    sum := 0;
    while n > 0 do
    begin
        sum := sum + n;
        n := n - 1
    end;
    write(sum)
end.
```

**è¾“å‡º**: `15` (1+2+3+4+5)

### ç¤ºä¾‹ 3: è¿‡ç¨‹è°ƒç”¨

```pl0
var x;

procedure inc;
begin
    x := x + 1
end;

begin
    x := 10;
    call inc;
    call inc;
    write(x)
end.
```

**è¾“å‡º**: `12`

æ›´å¤šç¤ºä¾‹è¯·æŸ¥çœ‹ `examples/` æ–‡ä»¶å¤¹ï¼ˆåŒ…å« 10 ä¸ªå®Œæ•´ç¤ºä¾‹ï¼‰ã€‚

## âš™ï¸ å››å…ƒå¼ä¸­é—´ä»£ç 

å››å…ƒå¼æ ¼å¼ï¼š**(æ“ä½œç¬¦, å‚æ•°1, å‚æ•°2, ç»“æœ)**

### å¸¸ç”¨æ“ä½œç¬¦

| æ“ä½œç¬¦ | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| = | èµ‹å€¼ | `(=, 10, -, x)` |
| +, -, *, / | ç®—æœ¯è¿ç®— | `(+, a, b, T0)` |
| <, >, =, #, <=, >= | å…³ç³»è¿ç®— | `(<, x, y, T1)` |
| NEG | å–è´Ÿ | `(NEG, x, -, T2)` |
| ODD | å¥‡å¶åˆ¤æ–­ | `(ODD, x, -, T3)` |
| JMP | æ— æ¡ä»¶è·³è½¬ | `(JMP, -, -, 5)` |
| JZ | æ¡ä»¶è·³è½¬ï¼ˆä¸º0è·³è½¬ï¼‰ | `(JZ, T0, -, 10)` |
| CALL | è¿‡ç¨‹è°ƒç”¨ | `(CALL, proc, -, -)` |
| RET | è¿‡ç¨‹è¿”å› | `(RET, -, -, -)` |
| READ | è¯»è¾“å…¥ | `(READ, -, -, x)` |
| WRITE | å†™è¾“å‡º | `(WRITE, x, -, -)` |
| PROC | è¿‡ç¨‹å…¥å£ | `(PROC, name, -, L0)` |
| END | ç¨‹åºç»“æŸ | `(END, -, -, -)` |

## ğŸ” ä»£ç ç”Ÿæˆç¤ºä¾‹

**æºä»£ç ï¼š**
```pl0
var x;
begin
    x := 10;
    write(x)
end.
```

**ç”Ÿæˆçš„å››å…ƒå¼ï¼š**
```
åºå·  æ“ä½œç¬¦  å‚æ•°1  å‚æ•°2  ç»“æœ
0     =       10     -      x
1     WRITE   x      -      -
2     END     -      -      -
```

**ç¤ºä¾‹2ï¼šå¾ªç¯è¯­å¥**
```pl0
var n, sum;
begin
    n := 5;
    sum := 0;
    while n > 0 do
    begin
        sum := sum + n;
        n := n - 1
    end;
    write(sum)
end.
```

**ç”Ÿæˆçš„å››å…ƒå¼ï¼š**
```
åºå·  æ“ä½œç¬¦  å‚æ•°1  å‚æ•°2  ç»“æœ
0     =       5      -      n
1     =       0      -      sum
2     >       n      0      T0
3     JZ      T0     -      9
4     +       sum    n      T1
5     =       T1     -      sum
6     -       n      1      T2
7     =       T2     -      n
8     JMP     -      -      2
9     WRITE   sum    -      -
10    END     -      -      -
```

## ğŸ“š å‚è€ƒèµ„æ–™

- è¯¦ç»†æ–‡æ¡£ï¼š`guide/Semantic_Analysis.md`
- ç¤ºä¾‹ç¨‹åºï¼š`examples/` æ–‡ä»¶å¤¹
- æµ‹è¯•ç”¨ä¾‹ï¼š`test_semantic.py`

---

**æŠ€æœ¯æ ˆ**: Python 3.8+, Streamlit  
**ç¼–è¯‘åŸç†**: è¯æ³•åˆ†æ â†’ è¯­æ³•åˆ†æ â†’ è¯­ä¹‰åˆ†æ â†’ ä»£ç ç”Ÿæˆ â†’ è™šæ‹Ÿæœºæ‰§è¡Œ
